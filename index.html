<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> 

<html> 
  <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
 
    <!-- <script type="text/javascript" src="http://openspace.ordnancesurvey.co.uk/osmapapi/openspace.js?key=7713B6D550C700BCE0405F0AF1603C2F"> </script> -->
    <script type="text/javascript" src="http://openlayers.org/api/OpenLayers.js"> </script>

    <link rel="stylesheet" type="text/css" href="css/main.css" /> 
  </head> 
  <body  onload="init()"> 
  <div id="map" style="width: 100%;"></div> 
    <script type="text/javascript"> 
        var map, select;
        var controls, vectors;

        function init(){
            var options = {
                units: "m",
//                maxResolution: 156543.0339,
//                maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34,
//                                                 20037508.34, 20037508.34),
                controls: [
                             new OpenLayers.Control.LayerSwitcher(),
                             new OpenLayers.Control.Attribution(),
//                             new OpenLayers.Control.MousePosition(),
                             new OpenLayers.Control.PanZoomBar(),
                           ]
            };
            map = new OpenLayers.Map('map', options);
            var mapnik = new OpenLayers.Layer.TMS(
                "OpenStreetMap (Mapnik)",
                "http://tile.openstreetmap.org/",
                {
                    type: 'png', getURL: osm_getTileURL,
                    displayOutsideMaxExtent: true,
                    attribution: '<a href="http://www.openstreetmap.org/">OpenStreetMap</a>'
                }
            );
            var gmap = new OpenLayers.Layer.Google("Google", {sphericalMercator:true});

            //var sundials = new OpenLayers.Layer.Vector("KML", {
            //    projection: map.displayProjection,
            //    strategies: [new OpenLayers.Strategy.Fixed()],
            //    protocol: new OpenLayers.Protocol.HTTP({
            //        url: "kml/sundials.kml",
            //        format: new OpenLayers.Format.KML({
            //            extractStyles: true,
            //            extractAttributes: true
            //        })
            //    })
            //});

            vectors = new OpenLayers.Layer.Vector("Annotations");
            map.addLayers([mapnik, vectors/*, gmap, sundials*/]);


            var editControls = [
             new OpenLayers.Control.DrawFeature(vectors, OpenLayers.Handler.Point, {'displayClass': 'olControlDrawFeaturePoint'}),
             new OpenLayers.Control.DrawFeature(vectors, OpenLayers.Handler.Path, {'displayClass': 'olControlDrawFeaturePath'}),
             new OpenLayers.Control.DrawFeature(vectors, OpenLayers.Handler.Polygon, {'displayClass': 'olControlDrawFeaturePolygon'}),
            ];

            var navControls = [
             new OpenLayers.Control.Navigation(),
            ];


            var toolbar = new OpenLayers.Control.Panel({displayClass: 'olControlEditingToolbar', defaultControl: navControls[0]});
            toolbar.addControls(navControls);
            toolbar.addControls(editControls);
            map.addControl(toolbar);

            map.addControl(new OpenLayers.Control.Permalink());

            map.setCenter(new OpenLayers.LonLat(-1, -25), 6);

/*
            controls = {
                point: new OpenLayers.Control.DrawFeature(vectors,
                            OpenLayers.Handler.Point),
                line: new OpenLayers.Control.DrawFeature(vectors,
                            OpenLayers.Handler.Path),
                polygon: new OpenLayers.Control.DrawFeature(vectors,
                            OpenLayers.Handler.Polygon),
                drag: new OpenLayers.Control.DragFeature(vectors)
            };

            for(var key in controls) {
                map.addControl(controls[key]);
            }

            document.getElementById('noneToggle').checked = true;
*/
        }
/*
        function onPopupClose(evt) {
            select.unselectAll();
        }
*/
        function osm_getTileURL(bounds) {
            var res = this.map.getResolution();
            var x = Math.round((bounds.left - this.maxExtent.left) / (res * this.tileSize.w));
            var y = Math.round((this.maxExtent.top - bounds.top) / (res * this.tileSize.h));
            var z = this.map.getZoom();
            var limit = Math.pow(2, z);

            if (y < 0 || y >= limit) {
                return OpenLayers.Util.getImagesLocation() + "404.png";
            } else {
                x = ((x % limit) + limit) % limit;
                return this.url + z + "/" + x + "/" + y + "." + this.type;
            }
        }
/*
       function toggleControl(element) {
            for(key in controls) {
                var control = controls[key];
                if(element.value == key && element.checked) {
                    control.activate();
                } else {
                    control.deactivate();
                }
            }
        }
*/
    </script>
  </body>
</html>
